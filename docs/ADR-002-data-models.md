# This file is generated by Claude Sonnet 4.5

# ADR-002: Canonical Data Models

**Status**: Accepted  
**Date**: 2026-01-11

## Context

We need stable, shared data models between TypeScript (extension) and Python (backend) to ensure consistent data handling across the system.

## Decision

### Core Entities

#### 1. Document
- **ID**: UUID (generated client-side)
- **Type**: web_page | pdf | epub
- **Source**: URL or file reference
- **Metadata**: title, author, created_at, updated_at
- **Processing status**: local | uploading | processing | ready

#### 2. Highlight
- **ID**: UUID
- **Document ID**: Foreign key
- **Anchor**: Serialized Range (start/end offsets + context)
- **Quote text**: Extracted text
- **Color**: User preference
- **Created at**: Timestamp

#### 3. Note
- **ID**: UUID
- **Highlight ID**: Optional foreign key
- **Document ID**: Foreign key
- **Content**: User text
- **Metadata**: 
  - tags: string[]
  - type: summary | insight | todo | question
  - created_from: manual | selection | ai
  - confidence: number (0-1)
- **Timestamps**: created_at, updated_at

#### 4. TextChunk
- **ID**: UUID
- **Document ID**: Foreign key
- **Page number**: Optional (for PDFs)
- **Text content**: String
- **Character offsets**: start, end
- **Token count**: Integer
- **Vector ID**: Pinecone vector ID (after embedding)

#### 5. VectorReference
- **Chunk ID**: Foreign key
- **Vector ID**: Pinecone ID
- **Embedding status**: pending | embedded | failed
- **Embedded at**: Timestamp

## Consequences

### Positive
- Type safety across stack
- Clear relationships
- Supports offline-first sync
- Extensible metadata

### Negative
- Must maintain two schema definitions
- Schema migrations require coordination

## Implementation Notes

- TypeScript interfaces in `shared/types/`
- Python Pydantic models in `shared/models/`
- Shared ID generation strategy (UUIDv4)
- All timestamps in ISO 8601 format