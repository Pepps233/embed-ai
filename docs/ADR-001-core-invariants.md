# This file is generated by Claude Sonnet 4.5

# ADR-001: Core Invariants

**Status**: Accepted  
**Date**: 2026-01-11

## Context

Before implementing features, we must lock down the core architectural decisions that all subsequent work depends on.

## Decision

### Storage & Architecture
- **Local-first storage is mandatory**: IndexedDB via Dexie.js
- **Backend framework**: FastAPI (Python)
- **Vector database**: Pinecone
- **Embedding model**: BGE / Instructor
- **LLM**: Llama 3
- **Cloud storage**: Supabase Storage
- **Authentication**: Supabase Auth

### PDF Handling Strategy
- **Short PDFs** (< threshold): Client-side extraction with pdf.js, backend embedding
- **Large PDFs** (> threshold): Backend ingestion with PyMuPDF/pdfplumber
- **Threshold**: Configurable (default: 50 pages or 10MB)

### Data Flow
1. Client extracts text (DOM or PDF)
2. Client chunks text (300-500 tokens)
3. Backend generates embeddings
4. Pinecone stores vectors + metadata
5. Client caches chunk references (not vectors)

## Consequences

### Positive
- Clear separation of concerns
- Scalable from small to large documents
- Privacy-conscious (local-first)
- Fast user experience

### Negative
- Requires backend for all semantic features
- Complexity in sync logic
- Two different PDF pipelines to maintain

## Alternatives Considered

1. **Full client-side**: Rejected due to performance limits on large documents
2. **Full server-side**: Rejected due to privacy concerns and latency
3. **Client-side vector storage**: Rejected due to memory constraints
